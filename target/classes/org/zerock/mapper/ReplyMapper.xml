<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "org.zerock.mapper.ReplyMapper">

<insert id = "insert">
	insert into review (review_comment, review_score, order_code, product_code, customer_code) 
	values (#{review_comment}, #{review_score}, #{order_code}, #{product_code}, #{customer_code})
</insert>

<select id = "read" resultType = "org.zerock.domain.ReplyVO">
	select r.review_code, r.review_date, r.review_comment, r.review_score, r.order_code, r.product_code, r.customer_code, c.customer_name
	from review as r join customer as c
	on r.customer_code = c.customer_code
	where r.review_code = #{review_code}
</select>

<delete id = "delete">
	delete from review where review_code = #{review_code}
</delete>

<update id = "update">
	update review set review_comment = #{review_comment}, review_score = #{review_score} where review_code = #{review_code}
</update>

<!--product_code @param("customer_id") int customer_id 와 연결 -->
<select id = "getListWIthPaging" resultType = "org.zerock.domain.ReplyVO">
	<![CDATA[
		select r.review_code, r.review_date, r.review_comment, r.review_score, r.order_code, r.product_code, r.customer_code, c.customer_name 
		from review as r join customer as c 
		on r.customer_code = c.customer_code 
		where r.product_code = #{product_code} and r.review_code > (#{cri.pageNum}-1) * #{cri.amount} and r.review_code <= #{cri.pageNum} * #{cri.amount}
	]]>
</select>

<select id = "getCountByProductCode" resultType = "int">
	<![CDATA[
		select count(review_code) from review where product_code = #{product_code}
	]]>
</select>

<!-- 댓글 권한용 쿼리 -->
<select id = "ReplyAuthorityCustomer" resultType = "int">
	<![CDATA[
		select exists (
			select ob.customer_code 
			from order_basket as ob join customer as c
			on ob.customer_code = c.customer_code
			where ob.product_code = #{product_code} )
	]]>
</select>

<select id = "ReplyAuthorityProduct" resultType = "int">
	<![CDATA[
		select exists (
		select product_code from order_basket where customer_code = #{customer_code})
	]]>
</select>

<select id = "getOrderCode" resultType = "int">
	select order_code from order_basket where customer_code = #{customer_code}
</select>

<select id = "ReplyAuthorityStatus" resultType = "String">
	<![CDATA[
		select order_status from `order` where order_code = #{order_code}
	]]>
</select>
</mapper>